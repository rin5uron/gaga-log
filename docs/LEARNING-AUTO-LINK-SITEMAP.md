# 自動リンクとサイトマップの仕組みを学ぶ小課題

## 🎯 この課題で学べること

1. **アーティストページの自動リンク生成の仕組み**
2. **サイトマップの自動登録の仕組み**
3. **Next.jsの動的ルーティングの理解**
4. **ファイルシステムベースのデータ取得方法**

---

## 📚 事前知識（簡単に説明）

### 1. 自動リンクとは？
記事内で「Lady Gaga」と書くと、自動的に`/artists/lady-gaga`というページへのリンクになる仕組みです。

### 2. サイトマップとは？
Googleなどの検索エンジンに「このサイトにはこんなページがありますよ」と教えるためのファイルです。XML形式で、`/sitemap.xml`にアクセスすると見られます。

### 3. 動的ルーティングとは？
`/artists/[name]`のように、`[name]`の部分が変わることで、異なるページを表示する仕組みです。

---

## 🎓 課題1: 新しいアーティストページを作成してみよう

### ステップ1: ファイルを作成する

1. `content/artists/`フォルダに、新しいファイルを作成します
2. ファイル名は、アーティスト名をスラッグ（URLに使える形式）に変換したものにします
   - 例：`taylor-swift.md`、`ed-sheeran.md`

### ステップ2: テンプレートをコピーする

`templates/template-artist.md`の内容をコピーして、新しいファイルに貼り付けます。

### ステップ3: フロントマター（ファイルの先頭部分）を埋める

```yaml
---
name: "アーティスト名"
birthDate: "生年月日"
nationality: "国籍"
type: "artist"
musicStyle: "音楽スタイルの説明"
date: "2026-01-22"  # 今日の日付
updatedDate: "2026-01-22"
appleMusicUrl: "https://music.apple.com/jp/artist/..."
spotifyUrl: "https://open.spotify.com/artist/..."
---
```

### ステップ4: 内容を書く

テンプレートに沿って、アーティストの魅力を3つ書きます。

### ✅ 確認ポイント

- [ ] ファイルが`content/artists/`フォルダに正しく保存されているか
- [ ] ファイル名が`.md`で終わっているか
- [ ] フロントマターの`name`が正しく設定されているか

---

## 🎓 課題2: トップページに自動表示されることを確認しよう

### ステップ1: コードを確認する

`app/page.tsx`を開いて、以下の部分を見てみましょう：

```typescript
// 専用アーティストページ（content/artists/）からもアーティスト名を取得
const artistProfiles = getAllArtistProfiles();
const artistsFromProfiles = artistProfiles.map((profile) => profile.name);

// 両方をマージして重複を除去
const allArtistsSet = new Set([...artistsFromPosts, ...artistsFromProfiles]);
const artists = Array.from(allArtistsSet).sort();
```

### ステップ2: 動作を理解する

1. `getAllArtistProfiles()`は、`content/artists/`フォルダ内のすべての`.md`ファイルを読み込みます
2. 各ファイルのフロントマターから`name`を取得します
3. `PostList`コンポーネントに渡して、トップページに表示します

### ステップ3: 実際に確認する

開発サーバーを起動して、トップページを確認します：

```bash
npm run dev
```

ブラウザで`http://localhost:3000`を開いて、「アーティスト別」セクションに新しいアーティスト名が表示されているか確認しましょう。

### ✅ 確認ポイント

- [ ] トップページの「アーティスト別」セクションに新しいアーティスト名が表示されているか
- [ ] アーティスト名をクリックすると、`/artists/アーティスト名`のページに移動するか

---

## 🎓 課題3: サイトマップに自動登録されることを確認しよう

### ステップ1: コードを確認する

`app/sitemap.ts`を開いて、以下の部分を見てみましょう：

```typescript
// アーティストページ（プロファイルページがある場合はそれを使用、ない場合は記事から抽出）
const artistProfiles = getAllArtistProfiles();
const artistPagesFromProfiles = artistProfiles.map((artist) => ({
  url: `${baseUrl}/artists/${artist.slug}`,
  lastModified: new Date(artist.updatedDate || artist.date || new Date()),
  changeFrequency: 'weekly' as const,
  priority: 0.7,
}));
```

### ステップ2: 動作を理解する

1. `getAllArtistProfiles()`で、`content/artists/`フォルダ内のすべてのアーティストページを取得します
2. 各アーティストページの情報（URL、更新日など）をサイトマップの形式に変換します
3. Next.jsが自動的に`/sitemap.xml`を生成します

### ステップ3: 実際に確認する

開発サーバーを起動して、サイトマップを確認します：

```bash
npm run dev
```

ブラウザで`http://localhost:3000/sitemap.xml`を開いて、新しいアーティストページのURLが含まれているか確認しましょう。

### ✅ 確認ポイント

- [ ] `/sitemap.xml`に新しいアーティストページのURLが含まれているか
- [ ] URLの形式が`https://sound-feels.com/artists/アーティスト名`になっているか
- [ ] `lastModified`（最終更新日）が正しく設定されているか

---

## 🎓 課題4: 記事内でアーティスト名を自動リンク化してみよう

### ステップ1: コードを確認する

`app/posts/[slug]/page.tsx`を開いて、以下の部分を見てみましょう：

```typescript
// アーティスト名を自動的にリンク化する処理
const artists = getAllArtists();
// ... (記事本文を処理して、アーティスト名をリンクに変換)
```

### ステップ2: 動作を理解する

1. 記事本文を解析して、アーティスト名を見つけます
2. `getArtistSlug()`関数で、アーティスト名をURL用のスラッグに変換します
   - 例：「Lady Gaga」→「lady-gaga」
3. 見つかったアーティスト名を`<a href="/artists/lady-gaga">Lady Gaga</a>`のようなリンクに変換します

### ステップ3: 実際に試してみる

1. 既存の記事（例：`content/posts/shallow.md`）を開きます
2. 記事本文内に「Lady Gaga」と書かれている箇所を探します
3. 開発サーバーでその記事を表示して、アーティスト名がリンクになっているか確認します

### ✅ 確認ポイント

- [ ] 記事本文内のアーティスト名がリンクになっているか
- [ ] リンクをクリックすると、アーティストページに移動するか
- [ ] 同じアーティスト名が複数回出てきても、最初の1回だけリンクになっているか（通常のルール）

---

## 🎓 課題5: 仕組みを図解してみよう（理解度チェック）

以下の図を完成させて、仕組みを理解しましょう：

```
┌─────────────────────────────────────┐
│  1. ファイルを作成                  │
│  content/artists/new-artist.md      │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│  2. getAllArtistProfiles()          │
│  ファイルを読み込んで、              │
│  アーティスト情報を取得              │
└──────────────┬──────────────────────┘
               │
       ┌───────┴───────┐
       │               │
       ▼               ▼
┌──────────────┐  ┌──────────────┐
│ トップページ  │  │ サイトマップ   │
│ (page.tsx)   │  │ (sitemap.ts) │
└──────────────┘  └──────────────┘
```

### 質問に答えてみよう

1. **Q: `getAllArtistProfiles()`はどこにある関数ですか？**
   - A: `lib/artists.ts`ファイルにあります

2. **Q: トップページでアーティスト名を表示するために、どのコンポーネントを使っていますか？**
   - A: `PostList`コンポーネントです

3. **Q: アーティスト名をURL用のスラッグに変換する関数は何ですか？**
   - A: `getArtistSlug()`関数です（`lib/utils.ts`にあります）

4. **Q: サイトマップはどのURLで確認できますか？**
   - A: `/sitemap.xml`です

---

## 🎓 課題6: デバッグしてみよう（上級編）

### ステップ1: コンソールログを追加する

`app/page.tsx`に、以下のコードを追加して、何が取得されているか確認しましょう：

```typescript
export default function Home() {
  const posts = getAllPosts();
  const artistsFromPosts = getAllArtists();
  const artistProfiles = getAllArtistProfiles();
  
  // デバッグ用：コンソールに出力
  console.log('記事から取得したアーティスト:', artistsFromPosts);
  console.log('専用ページから取得したアーティスト:', artistProfiles.map(p => p.name));
  
  // ... 以下省略
}
```

### ステップ2: ブラウザの開発者ツールで確認する

1. ブラウザで`F12`キーを押して開発者ツールを開きます
2. 「Console」タブを開きます
3. ページをリロードして、コンソールに出力された内容を確認します

### ✅ 確認ポイント

- [ ] コンソールに、記事から取得したアーティスト名が表示されているか
- [ ] コンソールに、専用ページから取得したアーティスト名が表示されているか
- [ ] 両方が正しく取得されているか

---

## 📝 まとめ

この課題を通じて、以下のことを学びました：

1. ✅ **ファイルを作成する** → 自動的にシステムが認識する
2. ✅ **`getAllArtistProfiles()`関数** → ファイルを読み込んで情報を取得する
3. ✅ **トップページ** → 取得した情報を表示する
4. ✅ **サイトマップ** → 取得した情報をXML形式で出力する
5. ✅ **自動リンク** → 記事内のアーティスト名をリンクに変換する

### 次のステップ

- 新しいアーティストページを追加して、自動的にリンクが生成されることを確認する
- サイトマップが正しく更新されることを確認する
- 記事内でアーティスト名を書いて、自動リンク化されることを確認する

---

## 💡 補足：よくある質問

### Q: なぜ自動的にリンクが生成されるの？

A: Next.jsのビルド時に、すべてのファイルを読み込んで、必要な情報を取得します。その情報を使って、ページを生成したり、リンクを作成したりします。

### Q: サイトマップはいつ更新されるの？

A: Next.jsのビルド時（`npm run build`）または開発サーバー起動時（`npm run dev`）に自動的に生成されます。

### Q: 新しいアーティストページを追加したら、何をすればいいの？

A: 基本的には何もする必要はありません。ファイルを追加するだけで、自動的に：
- トップページに表示される
- サイトマップに登録される
- 記事内でリンク化される

ただし、本番環境に反映するには、デプロイ（`npm run build`とデプロイ）が必要です。

---

## 🎉 おめでとうございます！

この課題を完了したら、自動リンクとサイトマップの仕組みを理解できたことになります！
